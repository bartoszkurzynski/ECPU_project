---
title: "brudnopis"
output: pdf_document
date: "2025-01-31"
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(include = FALSE)
# Wczytanie danych
data <- read.csv(file = "czynniki.csv")
# Stworzenie ramki danych którymi się będziemy zajmować
data <- data.frame(data)
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Wczytywanie wymaganych pakietów
required_packages <- c("dplyr", "ggplot2", "finalfit", "VIM", "validate", 
        "errorlocate", "tidyverse", "ggcorrplot", "forcats",
        "ggthemes","tidyverse","dlookr","editrules","hrbrthemes","plotly",
        "ISLR","gapminder","kableExtra","ggstatsplot","gtsummary","readr")

# Sprawdzenie i instalacja brakujących pakietów
install_if_missing <- function(pkg) {
  if (!requireNamespace(pkg, quietly = TRUE)) install.packages(pkg)
}

sapply(required_packages, install_if_missing)

# Załadowanie pakietów
library(dplyr)
library(ggplot2)
library(finalfit)
library(VIM)
library(validate)
library(errorlocate)
library(tidyverse)
library(ggcorrplot)
library(forcats)
library(ggthemes)
library(dlookr)
library(editrules)
library(hrbrthemes)
library(plotly)
library(ISLR)
library(gapminder)
library(kableExtra)
library(ggstatsplot)
library(gtsummary)
library(readr)
```

# Analiza czynników wpływających na wyniki z egzaminów studentów

## Wstęp

### Cel projektu

Celem projektu jest analiza czynników wpływających na wyniki uczniów w
egzaminach. Badanie ma na celu zidentyfikowanie, które zmienne, takie
jak liczba godzin nauki, frekwencja czy wsparcie rodziny, mają
największy wpływ na sukces akademicki. Wyniki analizy mogą pomóc w
optymalizacji strategii edukacyjnych oraz wdrożeniu skutecznych metod
wsparcia dla uczniów o niższych wynikach.

### Opis problemu

Osiągnięcia akademickie uczniów są determinowane przez wiele czynników –
zarówno indywidualnych, jak i środowiskowych. Trudności w nauce, poziom
zaangażowania rodziców, dostęp do zasobów edukacyjnych czy aktywności
pozalekcyjne mogą znacząco wpływać na ostateczne wyniki. Analiza tych
czynników pozwoli na lepsze zrozumienie zależności i wsparcie uczniów w
poprawie wyników.

### Znaczenie analizy wyników uczniów

Zrozumienie czynników wpływających na wyniki egzaminacyjne jest istotne
z kilku powodów:

Optymalizacja strategii nauczania – analiza wyników może pomóc
nauczycielom i decydentom edukacyjnym w dostosowaniu metod nauczania do
potrzeb uczniów.

Wsparcie dla uczniów w trudnej sytuacji – identyfikacja kluczowych
czynników umożliwia wdrożenie skutecznych programów pomocy.

Poprawa efektywności edukacji – lepsze zrozumienie procesów nauczania
pozwala na skuteczniejsze zarządzanie systemem edukacyjnym.

## Opis danych

### Źródło danych

Dane wykorzystane w analizie pochodzą z anonimowego zbioru danych
dotyczącego uczniów szkół średnich. Zawierają one informacje na temat
wyników egzaminacyjnych oraz czynników potencjalnie wpływających na
sukces akademicki.

### Struktura zbioru danych

Zbiór danych zawiera następujące kolumny:

Zmienne numeryczne: Liczba godzin nauki, frekwencja, liczba sesji
korepetycji, wynik egzaminu itp.

Zmienne kategoryczne: Poziom zaangażowania rodziców, dostęp do zasobów
edukacyjnych, typ szkoły, aktywności pozalekcyjne itp.

### Opis zmiennych

Każda z analizowanych zmiennych pełni określoną funkcję w kontekście
analizy wyników uczniów. Główne zmienne to:

-   Hours Studied – liczba godzin nauki tygodniowo.

-   Attendance – procentowa frekwencja na zajęciach.

-   Tutoring Sessions – liczba godzin spędzonych na korepetycjach.

-   Parental Involvement – poziom zaangażowania rodziców (Low, Medium,
    High).

-   Access to Resources – dostęp do zasobów edukacyjnych (Low, Medium,
    High).

-   Motivation Level – poziom motywacji ucznia.

-   Previous Scores – wyniki ucznia z poprzednich egzaminów.

-   Exam Score – wynik końcowy z egzaminu.

Dane te zostaną poddane dalszej analizie w celu określenia ich wpływu na
końcowe wyniki uczniów.

## Przygotowanie danych

### Wizualizacja brakujących danych

Aby lepiej zrozumieć rozkład brakujących danych w naszym zbiorze,
wykonujemy kilka analiz:

-   Wykres `missing_plot()` przedstawia ogólny wzór brakujących wartości
    dla kluczowych zmiennych.

```{r echo=FALSE}
data <- as.data.frame(data)

data %>%
  dplyr::select(Hours_Studied, Attendance, Parental_Involvement, Access_to_Resources, Extracurricular_Activities, Sleep_Hours, 
                Previous_Scores, Motivation_Level, Internet_Access, Tutoring_Sessions, Family_Income, Teacher_Quality, School_Type,
                Peer_Influence, Physical_Activity, Learning_Disabilities, Parental_Education_Level, Distance_from_Home, Gender) %>%
  finalfit::missing_plot()
```

-   `missing_pattern()` pokazuje szczegółową strukturę braków.

```{r echo=FALSE}
data %>%
  dplyr::select(Hours_Studied,Attendance, Parental_Involvement,Access_to_Resources, Extracurricular_Activities, Sleep_Hours, 
                Previous_Scores, Motivation_Level, Internet_Access, Tutoring_Sessions, Family_Income, Teacher_Quality, School_Type,
                Peer_Influence, Physical_Activity, Learning_Disabilities, Parental_Education_Level, Distance_from_Home, Gender) %>%
  finalfit::missing_pattern()
```

-   `VIM::aggr()` pozwala sprawdzić, które zmienne mają najwięcej
    braków.

```{r echo=FALSE}
  # VIM method
data %>%
  dplyr::select(Hours_Studied,Attendance, Parental_Involvement,Access_to_Resources, Extracurricular_Activities, Sleep_Hours, 
                Previous_Scores, Motivation_Level, Internet_Access, Tutoring_Sessions, Family_Income, Teacher_Quality, School_Type,
                Peer_Influence, Physical_Activity, Learning_Disabilities, Parental_Education_Level, Distance_from_Home, Gender) %>%
  VIM::aggr(numbers = TRUE,
             prop    = FALSE) 
```

### Analiza zależności między zmiennymi

Analiza korelacji i zależności między zmiennymi pozwala określić, które
czynniki mają największy wpływ na wyniki egzaminacyjne. Przeprowadzona
analiza obejmuje obliczenie współczynników korelacji Spearmana dla
kluczowych zmiennych oraz ich wpływu na wynik końcowy.

```{r echo=FALSE, korelacja include=FALSE}
# Obliczenie korelacji Spearmana dla wielu zmiennych 
cor_vars <- c("Hours_Studied", "Attendance", "Tutoring_Sessions",
"Parental_Involvement", "Access_to_Resources", "Motivation_Level",
"Internet_Access", "Previous_Scores", "Family_Income",
"Teacher_Quality", "Peer_Influence", "Physical_Activity")

cor_results <- sapply(cor_vars, function(var) {
cor.test(czyste_dane[[var]],
czyste_dane$Exam_Score, method = "spearman")$estimate })
```

```{undefined echo=FALSE}
# Wyniki korelacji 
cor_results
```

```{r echo=FALSE}
data <- as.data.frame(data)

data %>%
  dplyr::select(Hours_Studied, Attendance, Parental_Involvement, Access_to_Resources, Extracurricular_Activities, Sleep_Hours, 
                Previous_Scores, Motivation_Level, Internet_Access, Tutoring_Sessions, Family_Income, Teacher_Quality, School_Type,
                Peer_Influence, Physical_Activity, Learning_Disabilities, Parental_Education_Level, Distance_from_Home, Gender) %>%
  finalfit::missing_plot()
```

### Czyszczenie danych i imputacja brakujących wartości

Pierwszą rzeczą jest ustalenie reguł dla wszystkich danych istniejących
oraz imputowanych. Pozwala to na usunięcie wartości skrajnie
odstających, które mogły być błędem przy wprowadzaniu danych.

```{r include=FALSE}
RULE <- validator(Hours_Studied >= 0, 
                    Hours_Studied <= 30,
                  Attendance >= 0,
                    Attendance <= 100,
                  Parental_Involvement %in% c("Low","Medium","High"),
                  Access_to_Resources %in% c("Low", "Medium", "High"),
                  Extracurricular_Activities %in% c("No","Yes"),
                  Sleep_Hours >= 0, 
                  Previous_Scores >= 0, 
                    Previous_Scores<= 100, 
                  Motivation_Level %in% c("Low","Medium","High"),
                  Internet_Access %in% c("No","Yes"),
                  Tutoring_Sessions >= 0,
                  Family_Income %in% c("Low","Medium","High"),
                  Teacher_Quality %in% c("Low","Medium","High"),
                  School_Type %in% c("Public","Private"),
                  Peer_Influence %in% c("Negative","Neutral","Positive"),
                  Physical_Activity >= 0,
                    Physical_Activity <= 25,
                  Learning_Disabilities %in% c("No","Yes"),
                  Parental_Education_Level %in% c("High School","College","Postgraduate"),
                  Distance_from_Home %in% c("Near","Moderate","Far"),
                  Gender %in% c("Male","Female"),
                  Exam_Score >= 0,
                  Exam_Score <= 100)

#sprawdzenie ilości danych które nie odpowidaja powyższym regułom ustalonym mna podstawie eksperckiej analizy
out   <- confront(data, RULE)

#zamiana danych typu character na factor
data <- data %>%
  mutate_if(is.character, as.factor)

#zastąpienie błędów na NA
data_no_error <- replace_errors(data,RULE)

#imputacja danych przez hotdeck
czyste_dane <- hotdeck(data_no_error)
```

Po zastosowaniu zasad w jakich dane mają być skondensowane mogły
wystąpić wartości puste (NA). Wartości te powstały w miejscach wartości,
które nie spełniały powyższych zasad.

Po uprzednim przygotowaniu danych oraz ich zidentyfikowaniu należy
przejść do imputacji danych. Do imputacji wybrano metodę hotdeck, która
polega na zastępowaniu brakujących wartości rzeczywistych danymi z tego
samego zbioru.

Przed przystąpieniem do analizy konieczne było usunięcie brakujących
wartości oraz poprawienie błędów w danych.

```{r echo=FALSE}
czyste_dane %>%
  dplyr::select(Hours_Studied,Attendance, Parental_Involvement,Access_to_Resources, Extracurricular_Activities, Sleep_Hours, 
                Previous_Scores, Motivation_Level, Internet_Access, Tutoring_Sessions, Family_Income, Teacher_Quality, School_Type,
                Peer_Influence, Physical_Activity, Learning_Disabilities, Parental_Education_Level, Distance_from_Home, Gender) %>%
  finalfit::missing_plot()
```
Po zwizualizowaniu brakujących danych można zauważyć, że nie ma już pustych wartości w danych. Zostały one skutecznie zastąpione za pomoca zastosowanej metody.
### Grupowanie danych i transformacja zmiennych

Dane zostały podzielone na grupy w celu ułatwienia analizy i
interpretacji wyników.

``` r
#Uszeregowanie danych w grupach
czyste_dane_temp$grupa1 <- factor(czyste_dane_temp$grupa1, levels = c("poniżej 16", "16-23", "powyżej 23"))
#wykres
ggplot(czyste_dane_temp, aes(x = grupa1, y = Exam_Score, fill = grupa1)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Wpływ godzin nauki na wynik egzaminu",
       x = "Ilość godzin nauki",
       y = "Wynik egzaminu") +
  scale_fill_brewer(palette = "Set4")

# Podział kolumny Exam_Score na grupy
czyste_dane_temp2 <- czyste_dane %>%
  mutate(grupa2 = case_when(
    Exam_Score < 60 ~ "2.0",                          # poniżej 60
    Exam_Score >= 60 & Exam_Score <= 65 ~ "3.0",      # 60 do 65
    Exam_Score >= 66 & Exam_Score <= 70 ~ "3.5",      # 66 do 70
    Exam_Score >= 71 & Exam_Score <= 80 ~ "4.0",      # 71 do 80
    Exam_Score >= 81 & Exam_Score <= 90 ~ "4.5",      # 81 do 90
    Exam_Score > 90 ~ "5.0",                          # powyżej 90
    TRUE ~ "Brak danych"                              # "Brak danych", by uniknąć NA
  ))
#ustawianie pogrupowanych danych jako factor
czyste_dane_temp2 <- czyste_dane_temp2 %>%
  mutate(grupa2 = factor(grupa2, levels = c("2.0", "3.0", "3.5", "4.0", "4.5", "5.0")))
```

## Eksploracyjna Analiza Danych (EDA)

### Rozkład wyników egzaminacyjnych

Analiza rozkładu wyników egzaminacyjnych pozwala ocenić, jak
zróżnicowane są osiągnięcia uczniów oraz czy dane zawierają ewentualne
wartości odstające.

``` r
# Histogram wyników egzaminacyjnych
ggplot(czyste_dane, aes(x = Exam_Score)) +
  geom_histogram(bins = 20, fill = "blue", color = "black", alpha = 0.7) +
  labs(title = "Rozkład wyników egzaminacyjnych",
       x = "Wynik egzaminu",
       y = "Liczba uczniów") +
  theme_minimal()
```

### Analiza korelacji między zmiennymi

W celu oceny, które zmienne są najsilniej powiązane z wynikami
egzaminacyjnymi, oszcowano model regresji liniowej.

``` r
# Regresja liniowa z wszystkimi czynnikami
model <- lm(Exam_Score ~ Hours_Studied + Attendance + Parental_Involvement + 
              Access_to_Resources + Extracurricular_Activities + Sleep_Hours + 
              Previous_Scores + Motivation_Level + Internet_Access + Tutoring_Sessions + 
              Family_Income + Teacher_Quality + School_Type + Peer_Influence + 
              Physical_Activity + Learning_Disabilities + Parental_Education_Level + 
              Distance_from_Home + Gender, 
            data=czyste_dane)
            
summary(model)
```

### Wpływ poszczególnych czynników na wyniki uczniów

Przeanalizowano wpływ kluczowych czynników, takich jak liczba godzin
nauki, frekwencja, dostęp do zasobów edukacyjnych oraz wsparcie rodziców
na wyniki egzaminacyjne.

``` r
# Boxplot: Wpływ godzin nauki na wynik egzaminu
ggplot(czyste_dane, aes(x = grupa1, y = Exam_Score, fill = grupa1)) +
  geom_boxplot() +
  labs(title = "Wpływ liczby godzin nauki na wynik egzaminu",
       x = "Liczba godzin nauki",
       y = "Wynik egzaminu") +
  theme_minimal()
```

``` r
# Boxplot: Wpływ frekwencji na wynik egzaminu
ggplot(czyste_dane, aes(x = grupa2, y = Attendance, fill = grupa2)) +
  geom_boxplot() +
  labs(title = "Zależność wyniku egzaminu od frekwencji",
       x = "Ocena końcowa",
       y = "Frekwencja (%)") +
  theme_minimal()
```

``` r
# Boxplot: Wpływ zaangażowania rodziców na wynik egzaminu
ggplot(czyste_dane, aes(x = Parental_Involvement, y = Exam_Score, fill = Parental_Involvement)) +
  geom_boxplot() +
  labs(title = "Wpływ zaangażowania rodziców na wyniki uczniów",
       x = "Zaangażowanie rodziców",
       y = "Wynik egzaminu") +
  theme_minimal()
```
